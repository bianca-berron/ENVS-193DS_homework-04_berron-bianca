---
title: "homework-04-code"
format: docx
editor: visual
execute: 
  warning: false
  message: false
---

## Quarto

```{r Set-up}
library(tidyverse)
library(here)
library(performance)
library(broom)
library(flextable)
library(ggeffects)
library(car)
library(naniar)
library(lterdatasampler)
```

# Problem 1. "How does fish length _predict_ fish weight for trout perch (across all sample years)?"

1) 
Biological:
Null Hypothesis: Fish length does not predict fish weight for trout perch.

Alternative Hypothesis: Fish length does predict fish weight for trout perch. 

Mathematical:
Null hypothesis: β_1 = 0

Alternative hypothesis: β_1 ≠ 0

2) 

```{r read-data}
fish_data <- read_csv(here("data", "ntl6_v12.csv"))
```

```{r filter-data}
fish_data_filtered <- fish_data %>% 
  filter(spname == "TROUTPERCH")
```

```{r missing-data-vis}
gg_miss_var(fish_data_filtered) +
  labs (caption = str_wrap("There are 0 missing data on fish length, however there are 200 missing data on fish weight which does affect our hypothesis in how fish length predicts fish weight."))
```

```{r}
ggplot(data = fish_data_filtered, aes(x = length, y = weight)) + 
  geom_point()
```


3 and 4)
```{r create-model-object}
modelobject <- lm(weight ~ length, data = fish_data_filtered) 

par(mfrow = c(2, 2))
plot(modelobject)

```

5)
Check assumptions:

1. linear relationship between variables: yes! (used exploratory data visualization to check that)
2. independence of errors: yes! (making that assumption based on how the data were collected)
3. homoskedasticity of errors: yes! (making that decision from residuals vs fitted plot/scale-location plots)
4. normally distributed errors: yes! (looking at QQ plot of residuals)



Residual vs fitted plot: plots the residuals (difference between obsered and expected values) versus the fitted line. Based on the how the residuals seem to be somewhat evenly and randomly distributed around the horizontal dotted line, one can confirm homosecdasticity . 

Normal Q-Q plot: looking at the qqplot, the residuals look normally distributed, as they a follow linear path. 

Scale-Location plot: plots fitted values versus the square root of the standardized residuals; plots seem to be somewhat evenly and randomly distributed around horizontal red line, implying homoscedasticity. 

Residuals vs leverage plot: there doesn't appear to be any residual outliers that are affecting the model predictions. 

6)
```{r summary-tables}
model_summary <- summary(modelobject)

model_summary
```

7)
```{r anova}
model_squares <- anova(modelobject)
model_squares
```

```{r}
model_squares_table <- tidy(model_squares) %>% 
  mutate(p.value = case_when(
    p.value < 0.001 ~ "< 0.001"
  )) %>% 
  mutate(term = case_when(
    term == "length" ~ "Trout Perch Fish Length (mm)", TRUE ~ term
  )) %>% 
  flextable() %>% 
  set_header_labels(df = "Degrees of Freedom", sumsq = "Sum of squares", meansq = "Mean squares", statistic = "F-statistic", p.value = "p-value")


model_squares_table
```

8) 
The ANOVA table directly relates to the information received from the summary() object. Both have a calculated F-statistic of about 1281 on 1 and 288 degrees of freedom, a p-value < 0.001, and the summary () object has an R^2 value of 0.8164. 

9)
We tested the hypothesis of whether or not fish length predicts fish weight for trout perch. The null hypothesis was that fish length does not predict fish weight for trout perch. Based on the samples and data, we found that fish length does predict fish weight for trout perch (F_1,288 = 1280.8, p < 0.001, R^2 = 0.82). 
10)
```{r predictions}
predictions <- ggpredict(modelobject, terms = "length")

predictions
```

```{r predictions-plot}
plot_predictions <- ggplot(data = fish_data_filtered, aes(x = length, y = weight)) +
  geom_point() +
  geom_line(data = predictions, aes(x = x, y = predicted), color = "red", linewidth = 1) +
  geom_ribbon(data = predictions, aes(x = x, y = predicted, ymin = conf.low, ymax = conf.high), alpha = 0.2) +
  theme_bw() +
  labs (x = "Fish Length (mm)", y = "Fish Weight (g)", 
        caption = "Fish length predicts fish weight through a linear relationship. Based on our observations, for every 1.0 mm increase in fish length, we expect a 0.2 g increase in fish weight.")

plot_predictions
```

